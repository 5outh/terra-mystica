<!DOCTYPE html>
<html lang="en">
  <head>
    <script type="text/javascript" language="javascript"
            src="/stc/prototype-1.6.0.3.js">
    </script>
    <script type="text/javascript" language="javascript"
            src="/stc/debug.js">
    </script> 
    <script type="text/javascript" language="javascript"
            src="/stc/edit.js">
    </script>
    <title id="title">Terra Mystica Game Editor</title>
    <style type="text/css" media="screen">
    #editor { 
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        font-size: 14pt;
    }
    #wrapper {
        position: relative;
        height: 600px;
        width: 800px;
        border-style: solid;
    }
    </style>
    <link rel="stylesheet" type="text/css" href="/stc/style.css">
  </head>
  <body>

    <h3 id="header">Terra Mystica</h3>

    <div id="error"></div>

    <div id="wrapper">
      <div id="editor"></div>
    </div>
    
    <input type="button" value="Save" onClick="javascript:save()" id="save-button"/>

    <script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>

    <script>
      var id = document.location.pathname;

      var editor = ace.edit("editor");
      editor.getSession().setMode("ace/mode/sh");
      editor.commands.removeCommand("replace");
      editor.commands.removeCommand("gotoline");

      editor.commands.addCommand({
          name: 'mySave',
          bindKey: { win: 'Ctrl-S',  mac: 'Command-S' },
          exec: save
      });

      new Ajax.Request("/cgi-bin/edit.pl?game=" + id, {
          method:"get",
          onFailure: function(transport) {
             $("error").innerHTML = "Error opening game."
             $("save-button").disable();             
          },
          onSuccess: function(transport){
            try {
              editor.setValue(transport.responseText);
              editor.clearSelection();

              var title = editor.getValue().match("# (.*)");
              if (title && title[1]) {
                 $("title").innerHTML += " (" + title[1] + ")";
                 $("header").innerHTML += " (" + title[1] + ")";
              }
            } catch (e) {
              handleException(e);
            };
          }
      });
    </script>
  </body>
</html>

